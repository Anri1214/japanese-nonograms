import React, { Component } from 'react';
import * as _ from 'lodash';
import './Settings.scss';

/**
 * Class representing a Settings component.
 */
class Settings extends Component {
  /**
   * Initialize the component.
   * @param {Object} props - Component properties.
   */
  constructor (props) {
    super(props);
    this.state = {
      active: ''
    };
    this.config = {
      cat: {
        // eslint-disable-next-line
        data: { '0_2': 1, '0_4': 1, '1_1': 1, '1_2': 1, '1_4': 1, '1_5': 1, '2_1': 1, '2_2': 1, '2_3': 1, '2_4': 1, '2_5': 1, '3_0': 1, '3_1': 1, '3_3': 1, '3_5': 1, '3_6': 1, '3_9': 1, '4_1': 1, '4_2': 1, '4_3': 1, '4_4': 1, '4_5': 1, '4_8': 1, '4_9': 1, '5_2': 1, '5_3': 1, '5_4': 1, '5_8': 1, '6_0': 1, '6_1': 1, '6_2': 1, '6_3': 1, '6_4': 1, '6_5': 1, '6_8': 1, '6_9': 1, '7_0': 1, '7_2': 1, '7_3': 1, '7_4': 1, '7_5': 1, '7_6': 1, '7_9': 1, '8_2': 1, '8_3': 1, '8_4': 1, '8_5': 1, '8_6': 1, '8_7': 1, '8_8': 1, '8_9': 1, '9_1': 1, '9_2': 1, '9_4': 1, '9_5': 1, '9_6': 1, '9_7': 1 },
        sizeX: 10,
        sizeY: 10,
        cols: [],
        rows: [],
        title: '10x10',
        width: 0
      },
      elk: {
        // eslint-disable-next-line
        data: { '0_0': 1, '0_1': 1, '0_3': 1, '0_4': 1, '0_11': 1, '0_12': 1, '0_14': 1, '1_0': 1, '1_1': 1, '1_3': 1, '1_4': 1, '1_6': 1, '1_9': 1, '1_11': 1, '1_12': 1, '1_14': 1, '2_1': 1, '2_2': 1, '2_3': 1, '2_4': 1, '2_6': 1, '2_9': 1, '2_11': 1, '2_12': 1, '2_14': 1, '3_2': 1, '3_3': 1, '3_4': 1, '3_5': 1, '3_6': 1, '3_10': 1, '3_11': 1, '3_12': 1, '3_13': 1, '3_14': 1, '4_4': 1, '4_5': 1, '4_7': 1, '4_8': 1, '4_9': 1, '4_10': 1, '4_11': 1, '5_6': 1, '5_7': 1, '5_8': 1, '5_9': 1, '5_10': 1, '5_11': 1, '5_12': 1, '6_5': 1, '6_7': 1, '6_9': 1, '6_10': 1, '6_11': 1, '6_12': 1, '6_13': 1, '7_4': 1, '7_5': 1, '7_6': 1, '7_7': 1, '7_8': 1, '7_9': 1, '7_10': 1, '7_11': 1, '7_12': 1, '7_13': 1, '7_14': 1, '8_3': 1, '8_4': 1, '8_5': 1, '8_6': 1, '8_7': 1, '8_8': 1, '8_9': 1, '8_10': 1, '8_11': 1, '8_12': 1, '8_13': 1, '8_14': 1, '9_2': 1, '9_3': 1, '9_4': 1, '9_5': 1, '9_6': 1, '9_7': 1, '9_8': 1, '9_9': 1, '9_10': 1, '9_11': 1, '9_12': 1, '9_13': 1, '9_14': 1, '10_1': 1, '10_2': 1, '10_3': 1, '10_4': 1, '10_5': 1, '10_6': 1, '10_7': 1, '10_8': 1, '10_10': 1, '10_11': 1, '10_12': 1, '10_13': 1, '10_14': 1, '11_1': 1, '11_3': 1, '11_4': 1, '11_5': 1, '11_10': 1, '11_11': 1, '11_12': 1, '11_13': 1, '11_14': 1, '12_1': 1, '12_2': 1, '12_3': 1, '12_4': 1, '12_5': 1, '12_10': 1, '12_11': 1, '12_12': 1, '12_13': 1, '12_14': 1, '13_2': 1, '13_3': 1, '13_4': 1, '13_9': 1, '13_10': 1, '13_11': 1, '13_12': 1, '13_13': 1, '13_14': 1, '14_9': 1, '14_10': 1, '14_11': 1, '14_12': 1, '14_13': 1, '14_14': 1 },
        sizeX: 15,
        sizeY: 15,
        cols: [],
        rows: [],
        title: '15x15',
        width: 0
      },
      dino: {
        // eslint-disable-next-line
        data: { '0_2': 1, '0_3': 1, '0_4': 1, '1_0': 1, '1_1': 1, '1_2': 1, '1_4': 1, '1_5': 1, '2_0': 1, '2_1': 1, '2_2': 1, '2_3': 1, '2_4': 1, '2_5': 1, '3_3': 1, '3_4': 1, '3_5': 1, '3_6': 1, '4_0': 1, '4_1': 1, '4_2': 1, '4_3': 1, '4_4': 1, '4_5': 1, '4_6': 1, '5_4': 1, '5_5': 1, '5_6': 1, '5_7': 1, '5_8': 1, '6_3': 1, '6_4': 1, '6_5': 1, '6_6': 1, '6_7': 1, '6_8': 1, '6_9': 1, '6_10': 1, '7_3': 1, '7_4': 1, '7_5': 1, '7_6': 1, '7_7': 1, '7_8': 1, '7_9': 1, '7_10': 1, '7_11': 1, '8_3': 1, '8_4': 1, '8_5': 1, '8_6': 1, '8_8': 1, '8_9': 1, '8_10': 1, '8_11': 1, '8_12': 1, '9_2': 1, '9_3': 1, '9_4': 1, '9_5': 1, '9_8': 1, '9_9': 1, '9_10': 1, '9_11': 1, '9_12': 1, '9_13': 1, '10_2': 1, '10_4': 1, '10_5': 1, '10_7': 1, '10_8': 1, '10_9': 1, '10_10': 1, '10_11': 1, '10_12': 1, '10_13': 1, '11_4': 1, '11_5': 1, '11_6': 1, '11_7': 1, '11_8': 1, '11_9': 1, '11_10': 1, '11_11': 1, '11_12': 1, '11_13': 1, '11_14': 1, '11_17': 1, '12_5': 1, '12_6': 1, '12_7': 1, '12_8': 1, '12_9': 1, '12_10': 1, '12_11': 1, '12_12': 1, '12_13': 1, '12_14': 1, '12_18': 1, '13_5': 1, '13_6': 1, '13_7': 1, '13_8': 1, '13_9': 1, '13_10': 1, '13_11': 1, '13_12': 1, '13_13': 1, '13_14': 1, '13_18': 1, '13_19': 1, '14_6': 1, '14_7': 1, '14_8': 1, '14_9': 1, '14_10': 1, '14_11': 1, '14_12': 1, '14_13': 1, '14_14': 1, '14_19': 1, '15_5': 1, '15_6': 1, '15_7': 1, '15_9': 1, '15_10': 1, '15_11': 1, '15_12': 1, '15_13': 1, '15_14': 1, '15_15': 1, '15_19': 1, '16_5': 1, '16_6': 1, '16_10': 1, '16_11': 1, '16_13': 1, '16_14': 1, '16_15': 1, '16_19': 1, '17_5': 1, '17_10': 1, '17_11': 1, '17_13': 1, '17_14': 1, '17_15': 1, '17_18': 1, '17_19': 1, '18_4': 1, '18_5': 1, '18_9': 1, '18_10': 1, '18_14': 1, '18_15': 1, '18_16': 1, '18_17': 1, '18_18': 1, '19_3': 1, '19_4': 1, '19_5': 1, '19_8': 1, '19_9': 1, '19_10': 1, '19_15': 1, '19_16': 1, '19_17': 1 },
        sizeX: 20,
        sizeY: 20,
        cols: [],
        rows: [],
        title: '20x20',
        width: 0
      }
    };
  }

  /**
   * Run after component is mounted.
   */
  componentDidMount () {
    this.generate();
    this.selectGame('cat');
  }

  /**
   * Calculate total true value in row
   * @param {Array} row - Nonogram row.
   * @return {Array}
   */
  calc (item, index, isRow) {
    let calc = 0;
    const result = [];
    const size = isRow ? item.sizeY : item.sizeX;

    for (let i = 0; i < size; i++) {
      if (!item.data[isRow ? `${index}_${i}` : `${i}_${index}`]) {
        if (calc) {
          result.push(calc);
        }
        calc = 0;
      } else {
        calc++;
      }
    }
    if (calc) {
      result.push(calc);
    }
    return result;
  }

  /**
   * Generate column and row rules.
   */
  generate () {
    _.forEach(this.config, item => {
      for (let i = 0; i < item.sizeX; i++) {
        item.rows[i] = this.calc(item, i, true);
      }
      for (let i = 0; i < item.sizeY; i++) {
        item.cols[i] = this.calc(item, i, false);
      }

      item.width = Math.max(...item.rows.map(r => r.length));
    });
  }

  /**
   * Select active game.
   * @param {String} name - Game name.
   */
  selectGame (name) {
    const config = this.config[name];

    this.props.setSettings({}, config);
    this.setState({active: name});
  }

  /**
   * Render component.
   * @return {XML}
   */
  render () {
    return (
      <section className='jn-settings'>
        {
          this.props.path.includes('game') && _.map(this.config, (val, key) => {
            return (
              <button
                key={ key }
                onClick={ () => this.selectGame(key) }
                className={`
                  jn-settings__item
                  ${ key === this.state.active && 'jn-settings__item--active' }
                `}
              >
                { val.title }
              </button>
            );
          })
        }
      </section>
    );
  }
}

export default Settings;
